
<html>
 <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Scoring - Continental Divide</title>

<body>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" crossorigin="anonymous">
<style>
body{     padding: 5px 20px; }



.btn { color: #fff !important; }

.btn.pink { background-color: pink !important; color: #000 !important;}
.btn.red { background-color: red; }
.btn.blue { background-color: blue; }
.btn.black { background-color: black; }
.btn.yellow { background-color: yellow; color: #000 !important;}
.btn.brown { background-color: brown; }
.btn.purple { background-color: purple; }
.btn.green { background-color: green; }

.player input { width: 75px; }

input[type="number"] { width: 40px; }



.spinner {
  width: 100px;
}
.spinner input {
  text-align: right;
  width: 50% !important;
}
.input-group-btn-vertical {
  position: relative;
  white-space: nowrap;
  width: 1%;
  vertical-align: middle;
  display: table-cell;
  left: -40%;
}
.input-group-btn-vertical > .btn {
  display: block;
  float: none;
  width: 100%;
  max-width: 100%;
  padding: 8px;
  margin-left: -1px;
  position: relative;
  border-radius: 0;
}
.input-group-btn-vertical > .btn:first-child {
  border-top-right-radius: 4px;
}
.input-group-btn-vertical > .btn:last-child {
  margin-top: -2px;
  border-bottom-right-radius: 4px;
}
.input-group-btn-vertical i{
  position: absolute;
  top: 0;
  left: 4px;
}


</style>

<div class="row">

  <div class=".col-xs-12 .col-sm-6 .col-md-8">
    <h2>Company</h2>
    
    <div class="company"  >
      <button class="btn blue ">Blue</button>
      <button class="btn red ">Red</button>
      <button class="btn yellow ">Yellow</button>
      <button class="btn pink ">Pink</button>
      <button class="btn green ">Green</button>
      
      <button class="btn purple ">Purple</button>
      <button class="btn brown ">Brown</button>
      <button class="btn black ">Black</button>

    </div>


    <div class="stock_value"> 
          <span>Stock Value</span> 
          <span><div class="input-group spinner"> 
          <input type="text" class="form-control" value="0" > 
      <div class="input-group-btn-vertical"> 
        <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></a> 
        <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></a> 
      </div> 
    </div></span> 
        </div> 
        <div class="stocks_issued"> 
          <span>Stocks Issued</span> 
          <span><div class="input-group spinner"> 
      <input type="text" class="form-control" value="0" > 
      <div class="input-group-btn-vertical"> 
        <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></a> 
        <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></a> 
      </div> 
    </div></span> 
        </div> 
        <button type="button" class="btn btn-primary setCompanyStock" autocomplete="off"> 
          Set 
        </button> 
        <div class="rr_income hidden"> 
          <span>RR Income</span> 
          <span><div class="input-group spinner"> 
      <input type="text" class="form-control" value="0" > 
      <div class="input-group-btn-vertical"> 
        <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></a> 
        <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></a> 
      </div> 
    </div></span> 
        </div> 
        <div class="rr_treasury hidden"> 
          <span>RR Treasury</span> 
          <span id="rr_treasury__val">0</span> 
        </div> 
        <div class="current_dividend hidden"> 
          <span>Dividend</span> 
          <span id="current_dividend__val">0</span> 
        </div> 
        <div class="stock_price hidden"> 
          <span>Stock Price</span> 
          <span id="stock_price__val">0</span> 
        </div> 
        <div class="dividend_payment hidden"> 
          <span>Div Pmt</span> 
          <span id="dividend_payment__val">0</span> 
        </div>

  </div>
</div>
<div class="row">

  <div class=".col-xs-12 .col-sm-6 .col-md-8 log">
  </div>
</div>


<div class="modal fade" tabindex="-1" role="dialog" id="modal--username">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Enter your name</h4>
      </div>
      <div class="modal-body">
        Username: <input type="text" id="username">
        <div class="dropdown">
          <button class="btn btn-default dropdown-toggle" type="button" id="available_games_dd" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            Dropdown
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" aria-labelledby="available_games_dd">
            
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Save</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Latest compiled and minified JavaScript -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

<script>

  var socket = io();
  var game_name = 'continental_divide';

  var user = localStorage.getItem("game-scoring--username");



  socket.on('save username', function(msg){
    $('.log').append($('<li>').text(msg));
  }); 

$( document ).ready(function() {
  var companies = ['blue','red', 'yellow', 'pink', 'green', 'brown', 'purple', 'black', ''];

  socket.emit('available_games', game_name);

  socket.on('available_games', function(games){
    console.log(games);
    var html = '';
    for(var x=0,len=games.length;x<len;x++){
      console.log(games[x]);
      html += '<li>'+games[x].game+' - '+games[x].date+'</li>';
    }
    $('.dropdown-menu[aria-labelledby="available_games_dd"]').html(html);
  });

  $('#modal--username').modal({
    show:true
  });

  $(".company .btn").click(function(){
    $(".company .btn").removeClass('active');
    $(this).toggleClass('active');
  });

  // if(user === null || user === undefined || user == ''){
  //   $('#modal--username').modal('toggle');
  // }

  $("#modal--username button").click(function(event){
    localStorage.setItem("game-scoring--username", $("#username").val() );

    user = localStorage.getItem("game-scoring--username");
    socket.emit('save username', user);
    $('#modal--username').modal('toggle');
  });

  $(".setCompanyStock").click(function(){
    var sv = parseInt($(this).parent().find('.stock_value input').val(), 10);
    var si = parseInt($(this).parent().find('.stocks_issued input').val(), 10);
    if( (sv >= 10 && sv <=50) && (si >=3 && si <= 10) ){
      $(this).toggleClass('hidden');
      $(this).parent().find('.stocks_issued').toggleClass('hidden');
      $(this).parent().find('.stock_value').toggleClass('hidden');

      $(this).parent().find('.rr_income ').toggleClass('hidden');
      $(this).parent().find('.rr_treasury').toggleClass('hidden');
      $(this).parent().find('.current_dividend').toggleClass('hidden');
      $(this).parent().find('.stock_price').toggleClass('hidden');
      $(this).parent().find('.dividend_payment').toggleClass('hidden');

    } else {
      $(this).parent().prepend('<div class="alert alert-warning alert-dismissible fade in" role="alert"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—</span></button> <strong>Stocks Issued must be 3-10 & Stock Value must be 10-50.</div>');
    }
  });

  $('.spinner .form-control').on('keyup', function(event) {
    var val = parseInt($(this).val(), 10);
    var spinner = $(this).parent().parent().find('input');

    if(event.keyCode == 38){
      $(this).val(val+1);
    }
    if(event.keyCode == 40 && val > 0){
      $(this).val(val-1);
    }
    update();
  });

  $('.spinner .btn:first-of-type').on('click', function() {
    var spinner = $(this).parent().parent().find('input');
    var val = parseInt($(spinner).val(), 10);
    $(spinner).val( val + 1);
    update();
  });
  $('.spinner .btn:last-of-type').on('click', function() {
    var spinner = $(this).parent().parent().find('input');
    var val = parseInt($(spinner).val(), 10);
    if(val > 0){
      $(spinner).val( val - 1);
      update();
    }
  });

  function update(){
    calcDividend();
    calcStockPrice();
    calcDividendPayment();

    socket.emit('update_company', {
      company: $(".company .btn.active").text(),
      stocks_issued: parseInt($(".stocks_issued input").val()),
      rr_income: parseInt($(".rr_income input").val()),
      current_dividend: parseInt($("#current_dividend__val").text()),
      stock_value: parseInt($(".stock_value input").val()),
      stock_price: parseInt($("#stock_price__val").text()),
      dividend_payment: parseInt($('#dividend_payment__val').text())
    });
  }


  function calcDividend(){
    var si = parseInt($(".stocks_issued input").val());
    var ri = parseInt($(".rr_income input").val());

    var dividend = Math.ceil( parseFloat(ri/si) );
    $("#current_dividend__val").html(dividend);
  }

  function calcStockPrice(company){
    var sv = parseInt($(".stock_value input").val());
    var dv = parseInt($("#current_dividend__val").text());

    var stock_price = sv+dv
    $("#stock_price__val").html(stock_price);
  }

  function calcDividendPayment(company){
    var dv = parseInt($("#current_dividend__val").text());
    var si = parseInt($(".stocks_issued input").val());

    var outstanding_stock = 0;

    $('#dividend_payment__val').html( (si - outstanding_stock) * dv );
  }



});

</script>
</body>
</html>